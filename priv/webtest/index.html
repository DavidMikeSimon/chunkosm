<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Foo!</title>
    <script 
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular.js"></script>
    <script src="http://rawgit.com/gdi2290/angular-websocket/v1.0.9/angular-websocket.js"></script>
    <script src="http://cdn.rawgit.com/jashkenas/coffee-script/master/extras/coffee-script.js"></script>
</head>
<body>
    <script type="text/coffeescript">
        angular.module('WerldClient', ['ngWebSocket'])
        
        angular.module('WerldClient').factory 'MyData', ($websocket, $location) ->
            dataStream = $websocket("ws://#{$location.host()}:#{$location.port()}/websocket")

            collection = []

            dataStream.onMessage (message) ->
                if message.data instanceof Blob
                    #fileReader = new FileReader()
                    #arrayBuffer = null
                    #fileReader.onload = -> arrayBuffer = this.result
                    #fileReader.readAsArrayBuffer message.data
                    
                else
                    collection.push message.data
            
            dataStream.onOpen ->
                dataStream.send("Foo")

            return {collection: collection}
            
        angular.module('WerldClient').controller 'SomeController', ($scope, MyData) ->
            $scope.MyData = MyData
         
        angular.bootstrap(document.body, ['WerldClient'])
    </script>
    
    <section ng-controller="SomeController">
        <ul>
            <li ng-repeat="data in MyData.collection track by $index">
                {{ data }}
            </li>
        </ul>
    </section>
</body>
</html>